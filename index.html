<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>InfoGares - Metz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: #fff;
        }

        .config {
            max-width: 500px;
            margin: 100px auto;
            padding: 30px;
            background: white;
            color: black;
            border-radius: 10px;
        }

        .config h1 {
            margin-bottom: 20px;
        }

        .config input, .config select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .config button {
            width: 100%;
            padding: 15px;
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        .board {
            display: none;
        }

        .top-bar {
            background: #1a1a1a;
            padding: 10px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #ffcc00;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #ffcc00;
        }

        .clock-display {
            font-size: 24px;
            font-weight: bold;
            color: #ffcc00;
            font-family: monospace;
        }

        .station-selector {
            background: #2a2a2a;
            padding: 15px 30px;
            border-bottom: 2px solid #444;
        }

        .station-selector select {
            padding: 8px 15px;
            font-size: 16px;
            background: #000;
            color: #ffcc00;
            border: 2px solid #ffcc00;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .station-selector label {
            margin-right: 10px;
            font-size: 16px;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #000;
        }

        thead {
            background: #1a1a1a;
        }

        th {
            padding: 12px 15px;
            text-align: left;
            font-size: 13px;
            font-weight: bold;
            color: #ffcc00;
            border-bottom: 2px solid #ffcc00;
            text-transform: uppercase;
        }

        tbody tr {
            border-bottom: 1px solid #333;
        }

        tbody tr:hover {
            background: #1a1a1a;
        }

        td {
            padding: 15px;
            font-size: 16px;
            vertical-align: middle;
        }

        .status-col {
            width: 120px;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            text-align: center;
        }

        .status-ontime {
            background: #00aa00;
            color: white;
        }

        .status-delayed {
            background: #ff3333;
            color: white;
        }

        .train-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .train-type {
            background: #0066cc;
            color: white;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
        }

        .train-type.tgv {
            background: #8b0000;
        }

        .train-type.ter {
            background: #0066cc;
        }

        .train-number {
            font-weight: bold;
            font-size: 18px;
        }

        .destination {
            font-size: 18px;
            font-weight: 500;
        }

        .time-display {
            font-family: monospace;
            font-size: 22px;
            font-weight: bold;
        }

        .time-real {
            color: #ffcc00;
        }

        .delay-info {
            font-weight: bold;
            font-size: 16px;
        }

        .delay-red {
            color: #ff3333;
        }

        .delay-green {
            color: #00ff00;
        }

        .platform {
            font-size: 32px;
            font-weight: bold;
            color: #ffcc00;
            text-align: center;
        }

        .info-flash {
            background: #1a1a1a;
            border-top: 3px solid #ffcc00;
            padding: 15px 30px;
            margin-top: 0;
        }

        .info-flash-title {
            color: #ffcc00;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .info-flash-content {
            color: #fff;
            font-size: 14px;
            animation: scroll-left 20s linear infinite;
            white-space: nowrap;
        }

        @keyframes scroll-left {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(-100%);
            }
        }

        .empty {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .error {
            background: #ff3333;
            padding: 15px 30px;
            display: none;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div id="config" class="config">
    <h1>Configuration InfoGares</h1>
    <p>Entrez votre cle API SNCF</p>
    <input type="text" id="apiKey" placeholder="Votre cle API">
    <select id="station">
        <option value="stop_area:SNCF:87212407">Metz-Ville</option>
        <option value="stop_area:SNCF:87212415">Noveant-sur-Moselle</option>
        <option value="stop_area:SNCF:87212381">Ancy-sur-Moselle</option>
        <option value="stop_area:SNCF:87212399">Ars-sur-Moselle</option>
    </select>
    <button onclick="start()">DEMARRER</button>
</div>

<div id="board" class="board">
    <div class="top-bar">
        <div class="logo">InfoGares</div>
        <div class="clock-display" id="clock"></div>
    </div>

    <div class="station-selector">
        <label>GARE :</label>
        <select id="stationChange" onchange="changeStation()">
            <option value="stop_area:SNCF:87212407">METZ-VILLE</option>
            <option value="stop_area:SNCF:87212415">NOVEANT-SUR-MOSELLE</option>
            <option value="stop_area:SNCF:87212381">ANCY-SUR-MOSELLE</option>
            <option value="stop_area:SNCF:87212399">ARS-SUR-MOSELLE</option>
        </select>
    </div>

    <div id="error" class="error"></div>

    <table>
        <thead>
            <tr>
                <th class="status-col">STATUT</th>
                <th>TRAIN</th>
                <th>DESTINATION</th>
                <th>HEURE</th>
                <th>RETARD</th>
                <th>VOIE</th>
            </tr>
        </thead>
        <tbody id="trains">
            <tr><td colspan="6" class="empty">Chargement des donnees...</td></tr>
        </tbody>
    </table>

    <div class="info-flash">
        <div class="info-flash-title">Informations Flash</div>
        <div class="info-flash-content" id="infoFlash">
            Bienvenue sur InfoGares - Informations en temps reel â€¢ Pensez a valider votre titre de transport avant de monter a bord â€¢ 
        </div>
    </div>
</div>

<script>
var key = '';
var stationCode = '';
var timer = null;

function start() {
    key = document.getElementById('apiKey').value;
    if (key) {
        key = key.replace(/^\s+|\s+$/g, '');
    }
    stationCode = document.getElementById('station').value;

    if (!key) {
        alert('Entrez votre cle API');
        return;
    }

    document.getElementById('stationChange').value = stationCode;
    document.getElementById('config').style.display = 'none';
    document.getElementById('board').style.display = 'block';

    refresh();
    timer = setInterval(refresh, 30000);
    setInterval(updateClock, 1000);
    updateClock();
}

function changeStation() {
    stationCode = document.getElementById('stationChange').value;
    refresh();
}

function refresh() {
    var url = 'https://api.sncf.com/v1/coverage/sncf/stop_areas/' + stationCode + '/departures?count=15';

    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.setRequestHeader('Authorization', key);

    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4) {
            if (xhr.status == 200) {
                var data = JSON.parse(xhr.responseText);
                if (data.departures && data.departures.length > 0) {
                    show(data.departures);
                    updateInfoFlash(data.disruptions);
                } else {
                    document.getElementById('trains').innerHTML = '<tr><td colspan="6" class="empty">Aucun depart prevu</td></tr>';
                }
            } else {
                document.getElementById('error').innerHTML = 'Erreur API - Verifiez votre cle';
                document.getElementById('error').style.display = 'block';
            }
        }
    };

    xhr.send();
}

function show(deps) {
    var html = '';

    for (var i = 0; i < deps.length; i++) {
        var d = deps[i];
        var t1 = new Date(d.stop_date_time.base_departure_date_time);
        var t2 = new Date(d.stop_date_time.departure_date_time);
        var delay = Math.floor((t2.getTime() - t1.getTime()) / 60000);

        var trainNum = d.display_informations.headsign || 'N/A';
        var trainType = 'TER';
        if (trainNum.indexOf('TGV') >= 0) {
            trainType = 'TGV';
        } else if (trainNum.indexOf('IC') >= 0) {
            trainType = 'IC';
        }

        var dest = d.display_informations.direction || 'Inconnu';
        var voie = '-';
        if (d.stop_point && d.stop_point.name) {
            voie = d.stop_point.name.replace('Voie ', '');
        }

        var statusBadge = '<span class="status-badge status-ontime">A l\'heure</span>';
        if (delay > 0) {
            statusBadge = '<span class="status-badge status-delayed">Retarde</span>';
        }

        var delayTxt = '-';
        var delayClass = 'delay-green';
        if (delay > 0) {
            delayTxt = '+' + delay + ' min';
            delayClass = 'delay-red';
        } else if (delay < 0) {
            delayTxt = delay + ' min';
        }

        var typeClass = trainType.toLowerCase();

        html = html + '<tr>';
        html = html + '<td class="status-col">' + statusBadge + '</td>';
        html = html + '<td><div class="train-info"><span class="train-type ' + typeClass + '">' + trainType + '</span><span class="train-number">' + trainNum + '</span></div></td>';
        html = html + '<td><span class="destination">' + dest + '</span></td>';
        html = html + '<td><span class="time-display time-real">' + formatTime(t2) + '</span></td>';
        html = html + '<td><span class="delay-info ' + delayClass + '">' + delayTxt + '</span></td>';
        html = html + '<td><span class="platform">' + voie + '</span></td>';
        html = html + '</tr>';
    }

    document.getElementById('trains').innerHTML = html;
}

function updateInfoFlash(disruptions) {
    var infoText = 'Bienvenue sur InfoGares - Informations en temps reel - ';
    
    if (disruptions && disruptions.length > 0) {
        var maxItems = disruptions.length;
        if (maxItems > 3) {
            maxItems = 3;
        }
        for (var i = 0; i < maxItems; i++) {
            if (disruptions[i].messages && disruptions[i].messages.length > 0) {
                infoText = infoText + disruptions[i].messages[0].text + ' - ';
            }
        }
    }
    
    infoText = infoText + 'Pensez a valider votre titre de transport avant de monter a bord - ';
    
    document.getElementById('infoFlash').innerHTML = infoText;
}

function formatTime(d) {
    var h = d.getHours();
    var m = d.getMinutes();
    if (h < 10) {
        h = '0' + h;
    }
    if (m < 10) {
        m = '0' + m;
    }
    return h + ':' + m;
}

function updateClock() {
    var n = new Date();
    var h = n.getHours();
    var m = n.getMinutes();
    var s = n.getSeconds();
    if (h < 10) {
        h = '0' + h;
    }
    if (m < 10) {
        m = '0' + m;
    }
    if (s < 10) {
        s = '0' + s;
    }
    var el = document.getElementById('clock');
    if (el) {
        el.innerHTML = h + ':' + m + ':' + s;
    }
}
</script>

</body>
</html>            padding: 10px 20px;
            background: black;
            color: #ffcc00;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .header #clock {
            float: right;
            margin-right: 20px;
            font-size: 18px;
            line-height: 40px;
            font-weight: bold;
        }
        
        .station-selector {
            background: #333;
            padding: 15px 20px;
            border-bottom: 2px solid #ffcc00;
        }
        
        .station-selector select {
            padding: 10px 15px;
            font-size: 16px;
            background: black;
            color: #ffcc00;
            border: 2px solid #ffcc00;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .station-selector label {
            margin-right: 10px;
            font-size: 16px;
            font-weight: bold;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: #1a1a1a;
        }
        
        th {
            background: #333;
            color: #ffcc00;
            padding: 15px;
            text-align: left;
            border-bottom: 2px solid #ffcc00;
            font-size: 14px;
            text-transform: uppercase;
        }
        
        td {
            padding: 20px 15px;
            border-bottom: 1px solid #333;
            font-size: 16px;
        }
        
        tr:hover {
            background: #2a2a2a;
        }
        
        .train-num {
            color: #ffcc00;
            font-weight: bold;
            font-size: 20px;
        }
        
        .time {
            font-family: monospace;
            font-size: 20px;
            font-weight: bold;
        }
        
        .time-real {
            color: #ffcc00;
        }
        
        .delay-red {
            color: #ff3333;
            font-weight: bold;
            font-size: 18px;
        }
        
        .delay-green {
            color: #00ff00;
            font-weight: bold;
        }
        
        .voie {
            color: #ffcc00;
            font-size: 28px;
            font-weight: bold;
        }
        
        .badge {
            padding: 6px 14px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .badge-ok {
            background: #00aa00;
            color: white;
        }
        
        .badge-late {
            background: #ff3333;
            color: white;
        }
    </style>
</head>
<body>

<div class="demo-banner">
    ðŸš§ MODE DEMO - DonnÃ©es fictives pour la demonstration ðŸš§
</div>

<div class="header">
    <h1>DEPARTS</h1>
    <button onclick="refresh()">ACTUALISER</button>
    <div id="clock"></div>
    <div style="clear:both"></div>
</div>

<div class="station-selector">
    <label>GARE :</label>
    <select id="station" onchange="changeStation()">
        <option value="metz">METZ-VILLE</option>
        <option value="noveant">NOVEANT-SUR-MOSELLE</option>
        <option value="ancy">ANCY-SUR-MOSELLE</option>
        <option value="ars">ARS-SUR-MOSELLE</option>
    </select>
</div>

<table>
    <thead>
        <tr>
            <th>TRAIN</th>
            <th>DESTINATION</th>
            <th>HEURE PREVUE</th>
            <th>HEURE</th>
            <th>RETARD</th>
            <th>VOIE</th>
            <th>ETAT</th>
        </tr>
    </thead>
    <tbody id="trains">
    </tbody>
</table>

<script>
var currentStation = 'metz';

var demoData = {
    metz: [
        {train: 'TER 88512', dest: 'Luxembourg', prevue: '22:45', reelle: '22:52', retard: 7, voie: '3', status: 'late'},
        {train: 'TER 88216', dest: 'Nancy', prevue: '22:58', reelle: '22:58', retard: 0, voie: '5', status: 'ok'},
        {train: 'TGV 2853', dest: 'Paris Est', prevue: '23:12', reelle: '23:12', retard: 0, voie: '1', status: 'ok'},
        {train: 'TER 88320', dest: 'Thionville', prevue: '23:25', reelle: '23:30', retard: 5, voie: '4', status: 'late'},
        {train: 'TER 88418', dest: 'Strasbourg', prevue: '23:38', reelle: '23:38', retard: 0, voie: '2', status: 'ok'},
        {train: 'TER 88522', dest: 'Luxembourg', prevue: '23:55', reelle: '00:03', retard: 8, voie: '3', status: 'late'},
        {train: 'TER 88224', dest: 'Nancy', prevue: '00:15', reelle: '00:15', retard: 0, voie: '5', status: 'ok'},
        {train: 'TER 88326', dest: 'Thionville', prevue: '00:28', reelle: '00:28', retard: 0, voie: '4', status: 'ok'}
    ],
    noveant: [
        {train: 'TER 88512', dest: 'Luxembourg', prevue: '22:52', reelle: '22:59', retard: 7, voie: '2', status: 'late'},
        {train: 'TER 88216', dest: 'Nancy', prevue: '23:05', reelle: '23:05', retard: 0, voie: '1', status: 'ok'},
        {train: 'TER 88320', dest: 'Thionville', prevue: '23:32', reelle: '23:37', retard: 5, voie: '2', status: 'late'},
        {train: 'TER 88418', dest: 'Strasbourg', prevue: '23:45', reelle: '23:45', retard: 0, voie: '1', status: 'ok'},
        {train: 'TER 88522', dest: 'Luxembourg', prevue: '00:02', reelle: '00:10', retard: 8, voie: '2', status: 'late'}
    ],
    ancy: [
        {train: 'TER 88512', dest: 'Luxembourg', prevue: '22:48', reelle: '22:55', retard: 7, voie: '1', status: 'late'},
        {train: 'TER 88216', dest: 'Nancy', prevue: '23:01', reelle: '23:01', retard: 0, voie: '2', status: 'ok'},
        {train: 'TER 88320', dest: 'Thionville', prevue: '23:28', reelle: '23:33', retard: 5, voie: '1', status: 'late'},
        {train: 'TER 88418', dest: 'Strasbourg', prevue: '23:41', reelle: '23:41', retard: 0, voie: '2', status: 'ok'},
        {train: 'TER 88522', dest: 'Luxembourg', prevue: '23:58', reelle: '00:06', retard: 8, voie: '1', status: 'late'}
    ],
    ars: [
        {train: 'TER 88512', dest: 'Luxembourg', prevue: '22:50', reelle: '22:57', retard: 7, voie: '1', status: 'late'},
        {train: 'TER 88216', dest: 'Nancy', prevue: '23:03', reelle: '23:03', retard: 0, voie: '2', status: 'ok'},
        {train: 'TER 88320', dest: 'Thionville', prevue: '23:30', reelle: '23:35', retard: 5, voie: '1', status: 'late'},
        {train: 'TER 88418', dest: 'Strasbourg', prevue: '23:43', reelle: '23:43', retard: 0, voie: '2', status: 'ok'},
        {train: 'TER 88522', dest: 'Luxembourg', prevue: '00:00', reelle: '00:08', retard: 8, voie: '1', status: 'late'}
    ]
};

function changeStation() {
    currentStation = document.getElementById('station').value;
    refresh();
}

function refresh() {
    var data = demoData[currentStation];
    var html = '';
    
    for (var i = 0; i < data.length; i++) {
        var t = data[i];
        
        var delayTxt = '-';
        var delayClass = 'delay-green';
        if (t.retard > 0) {
            delayTxt = '+' + t.retard + ' min';
            delayClass = 'delay-red';
        } else if (t.retard < 0) {
            delayTxt = t.retard + ' min';
        }
        
        var badge = '<span class="badge badge-ok">A l\'heure</span>';
        if (t.status == 'late') {
            badge = '<span class="badge badge-late">RetardÃ©</span>';
        }
        
        html = html + '<tr>';
        html = html + '<td><span class="train-num">' + t.train + '</span></td>';
        html = html + '<td>' + t.dest + '</td>';
        html = html + '<td><span class="time">' + t.prevue + '</span></td>';
        html = html + '<td><span class="time time-real">' + t.reelle + '</span></td>';
        html = html + '<td><span class="' + delayClass + '">' + delayTxt + '</span></td>';
        html = html + '<td><span class="voie">' + t.voie + '</span></td>';
        html = html + '<td>' + badge + '</td>';
        html = html + '</tr>';
    }
    
    document.getElementById('trains').innerHTML = html;
}

function updateClock() {
    var n = new Date();
    var h = n.getHours();
    var m = n.getMinutes();
    var s = n.getSeconds();
    if (h < 10) {
        h = '0' + h;
    }
    if (m < 10) {
        m = '0' + m;
    }
    if (s < 10) {
        s = '0' + s;
    }
    var el = document.getElementById('clock');
    if (el) {
        el.innerHTML = h + ':' + m + ':' + s;
    }
}

refresh();
setInterval(updateClock, 1000);
updateClock();
</script>

</body>

</html>


